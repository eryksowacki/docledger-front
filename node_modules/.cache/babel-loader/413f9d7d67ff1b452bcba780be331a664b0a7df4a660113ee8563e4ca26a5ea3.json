{"ast":null,"code":"// src/companyService.ts\nimport{apiFetch}from\"./api\";function buildQuery(params){if(!params)return\"\";const qs=new URLSearchParams();if(params.q&&params.q.trim()!==\"\")qs.set(\"q\",params.q.trim());if(typeof params.active===\"boolean\")qs.set(\"active\",String(params.active));if(params.sort)qs.set(\"sort\",params.sort);if(params.dir)qs.set(\"dir\",params.dir);const str=qs.toString();return str?\"?\".concat(str):\"\";}/**\n * Backend może zwracać:\n * - Company[]\n * - { data: Company[] }\n * - { data: Company[], meta, links } (paginacja)\n */function normalizeCompanies(resp){if(Array.isArray(resp))return resp;if(resp&&Array.isArray(resp.data))return resp.data;return[];}export async function listCompanies(params){const query=buildQuery(params);const resp=await apiFetch(\"/api/admin/companies\".concat(query),{method:\"GET\"});return normalizeCompanies(resp);}export async function getCompany(id){return apiFetch(\"/api/admin/companies/\".concat(id),{method:\"GET\"});}export async function createCompany(payload){return apiFetch(\"/api/admin/companies\",{method:\"POST\",body:JSON.stringify(payload)});}export async function updateCompany(id,payload){return apiFetch(\"/api/admin/companies/\".concat(id),{method:\"PATCH\",body:JSON.stringify(payload)});}/**\n * Ważne: używamy apiFetch, żeby:\n * - wysyłać cookies (credentials: include)\n * - wysyłać XSRF token (X-XSRF-TOKEN)\n * - mieć spójne parsowanie błędów\n */export async function deleteCompany(id){await apiFetch(\"/api/admin/companies/\".concat(id),{method:\"DELETE\"});}export async function listCompanyUsers(companyId){return apiFetch(\"/api/admin/companies/\".concat(companyId,\"/users\"),{method:\"GET\"});}","map":{"version":3,"names":["apiFetch","buildQuery","params","qs","URLSearchParams","q","trim","set","active","String","sort","dir","str","toString","concat","normalizeCompanies","resp","Array","isArray","data","listCompanies","query","method","getCompany","id","createCompany","payload","body","JSON","stringify","updateCompany","deleteCompany","listCompanyUsers","companyId"],"sources":["/var/www/web-szyper/src/companyService.ts"],"sourcesContent":["// src/companyService.ts\n\nimport { apiFetch } from \"./api\";\nimport type {\n    Company,\n    CompanyCreateRequest,\n    CompanyUpdateRequest,\n    CompanyUserRow,\n} from \"./types\";\n\nexport type CompanySort = \"id\" | \"name\" | \"taxId\" | \"active\";\nexport type SortDir = \"asc\" | \"desc\";\n\nexport interface CompanyListParams {\n    q?: string;\n    active?: boolean;\n    sort?: CompanySort;\n    dir?: SortDir;\n}\n\nfunction buildQuery(params?: CompanyListParams): string {\n    if (!params) return \"\";\n    const qs = new URLSearchParams();\n\n    if (params.q && params.q.trim() !== \"\") qs.set(\"q\", params.q.trim());\n    if (typeof params.active === \"boolean\") qs.set(\"active\", String(params.active));\n    if (params.sort) qs.set(\"sort\", params.sort);\n    if (params.dir) qs.set(\"dir\", params.dir);\n\n    const str = qs.toString();\n    return str ? `?${str}` : \"\";\n}\n\n/**\n * Backend może zwracać:\n * - Company[]\n * - { data: Company[] }\n * - { data: Company[], meta, links } (paginacja)\n */\ntype CompaniesApiResponse =\n    | Company[]\n    | { data: Company[] }\n    | { data: Company[]; meta?: any; links?: any };\n\nfunction normalizeCompanies(resp: CompaniesApiResponse): Company[] {\n    if (Array.isArray(resp)) return resp;\n    if (resp && Array.isArray((resp as any).data)) return (resp as any).data;\n    return [];\n}\n\nexport async function listCompanies(params?: CompanyListParams): Promise<Company[]> {\n    const query = buildQuery(params);\n    const resp = await apiFetch<CompaniesApiResponse>(`/api/admin/companies${query}`, {\n        method: \"GET\",\n    });\n    return normalizeCompanies(resp);\n}\n\nexport async function getCompany(id: number): Promise<Company> {\n    return apiFetch<Company>(`/api/admin/companies/${id}`, { method: \"GET\" });\n}\n\nexport async function createCompany(payload: CompanyCreateRequest): Promise<Company> {\n    return apiFetch<Company>(`/api/admin/companies`, {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n    });\n}\n\nexport async function updateCompany(\n    id: number,\n    payload: CompanyUpdateRequest\n): Promise<Company> {\n    return apiFetch<Company>(`/api/admin/companies/${id}`, {\n        method: \"PATCH\",\n        body: JSON.stringify(payload),\n    });\n}\n\n/**\n * Ważne: używamy apiFetch, żeby:\n * - wysyłać cookies (credentials: include)\n * - wysyłać XSRF token (X-XSRF-TOKEN)\n * - mieć spójne parsowanie błędów\n */\nexport async function deleteCompany(id: number): Promise<void> {\n    await apiFetch<void>(`/api/admin/companies/${id}`, { method: \"DELETE\" });\n}\n\nexport async function listCompanyUsers(companyId: number): Promise<CompanyUserRow[]> {\n    return apiFetch<CompanyUserRow[]>(\n        `/api/admin/companies/${companyId}/users`,\n        { method: \"GET\" }\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}